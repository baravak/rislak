!function(){var t=$("[data-nav]"),a=0,n=[],e=!1,i=$('[data-nav][data-type="item"]');function s(){var t=a,i=n[Math.min(a+1,n.length-1)];t!=Math.min(a+1,n.length-1)?location.hash="#"+i:e=!1}function r(){var t=a,i=n[Math.max(0,a-1)];t!=Math.max(0,a-1)?location.hash="#"+i:e=!1}t.each(function(t){var a=$(this).attr("data-nav"),e=$(this).attr("data-title");n.push(a);var i=$("<option></option>").attr("value",a).html(e);0==t&&i.attr("selected","selected"),$("[data-nav-count]").append(i)}),$("[data-nav-next]").on("click",function(){if(e)return!1;e=!0,s()}),$("[data-nav-prev]").on("click",function(){if(e)return!1;e=!0,r()}),$("[data-nav-count]").on("change",function(){$(this).attr("disabled","disabled"),location.hash="#"+$(this).val()}),$(window).on("hashchange",function(){var s=location.hash.replace(/^#/,"")||n[0],r=function(t){return n.indexOf(t)}(s);$("[data-nav-count]").val(s),function(n){t.addClass("hidden").css("display","none"),t.eq(a).trigger("pannel:hide"),t.eq(n).css("display","none").removeClass("hidden").fadeIn("slow",function(){$("[data-nav-count]").removeAttr("disabled"),e=!1,t.eq(n).trigger("pannel:show")}),a=n,"item"==t.eq(n).attr("data-type")?$("[data-nav-text]").html(t.eq(n).attr("data-nav")+"/"+i.length):$("[data-nav-text]").html("0/"+i.length);var s=a/(t.length-1)*100;$("#progress").css("width",s+"%")}(r>-1?r:0)}),$(window).trigger("hashchange"),$(document).on("keyup",function(n){if(e)return!0;if(n.ctrlKey||n.shiftKey||n.altKey||-1!=["Control","Shift","Alt","Meta"].indexOf(n.key))return!0;if("Enter"==n.key||"ArrowLeft"==n.key?s():"ArrowRight"==n.key&&r(),/^(Digit|Numpad)\d$/.test(n.code)){var i=n.code.replace(/Digit|Numpad/,"");if(t.eq(a).is('[data-type="item"]')&&t.eq(a).has("[data-keyboard="+i+"]")){var o=$("[data-keyboard="+i+"]",t.eq(a));"radio"==o.attr("type")&&(o[0].checked=!0,o.trigger("change"))}}}),$("input",'[data-type="item"]').on("change",function(){var t=JSON.parse($(this).attr("data-merge"));$(this).is(":radio")&&(t[1]=$(this).val(),$(this).parents('[data-type="item"]').attr("data-answer",$(this).val())),function(t){if(o.push(t),h)return!1;l=-1,$("[data-sync-status]").html("درحال ذخیره‌کردن..."),c()}(t),u()}),$("input",'[data-type="item"]').on("change",function(){if(-1==["optional","optional_images"].indexOf($(this).parents("[data-nav]").attr("data-answer-type")))return!0;if($(this).is(":radio")){$(this).next().css("opacity",""),$('[name="'+$(this).attr("name")+'"]').not('[value="'+$(this).val()+'"]').next().fadeTo("fast",.2);var t=this;setTimeout(function(){s(),$('[name="'+$(t).attr("name")+'"]').next().css("opacity","")},300)}});var o=[],h=!1,d=[1,3,5,10,15],l=0;function c(){h=!0;var t=o.splice(0);$.ajax({dataType:"json",url:"/$/"+sample_id+"/items",method:"post",data:{items:t}}).always(function(a,n){if("success"!=n){for(var e=0;e<t.length;e++)o.push(t[e]);$("[data-sync-status]").html("در تلاش برای ذخیره‌کردن..."),l=Math.min(l+1,d.length-1),setTimeout(c,1e3*d[l])}else o.length?(l=-1,c(),$("[data-sync-status]").html("درحال ذخیره‌کردن...")):(h=!1,$("[data-sync-status]").html("بدون تغییر"))})}function u(){var t=[],a=null;i.each(function(n){["optional","optional_images"].indexOf($(this).attr("data-answer-type"))>=0&&($(this).attr("data-answer")?(null!==a&&t.push([a,n]),a=null):null===a&&(a=n+1))}),null!==a&&t.push([a,i.length]),t.forEach(function(a,n){a[0]==a[1]?t[n]=a[0]:a[1]-a[0]==1?t[n]=a[0]+" و "+a[1]:t[n]=a[0]+" تا "+a[1],t[n]=$('<a href="#'+a[0]+'"></a>').text(t[n])}),$("#nav-empty-answers").html(""),$("#nav-empty-answers").append(t)}$('[data-nav="information"]').on("pannel:hide",function(){$("form",this).trigger("submit")}),u()}();