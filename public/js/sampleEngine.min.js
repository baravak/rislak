!function(){var e=$("#title").html(),t=0,a="description",n=new Object,i=new Object,o=!1,s=!1,r=[],d=[0,1,2],l=0;function c(){s=!0,$("#sync_status").text("درحال ذخیره سازی...");var e=r;r=[],$.ajax({dataType:"json",url:"/$/"+sample_id+"/items",method:"post",data:{items:e}}).always(function(t,a){if("success"!=a){$("#sync_alert").removeClass("d-none"),$("#sync_status").text("درحال تلاش دوباره...");for(var n=0;n<e.length;n++)r.push(e[n]);i=d[Math.min(Math.max(0,++l),d.length-1)],setTimeout(c,1e3*i)}else $("#sync_alert").addClass("d-none"),l=0,$("#sync_status").text("ذخیره شده"),r.length?c():s=!1;var i})}function h(){t=parseInt(Math.min(Math.max(0,++t),items.length+1)),location.hash="#"+t}function u(){$("#nav-count option").removeAttr("selected"),$("#nav-count select").is(":disabled")&&$("#nav-count select").removeAttr("disabled"),$("option[value="+t+"]").attr("selected","selected");var e=100*t/items.length;$("#progress").css("width",e+"%").attr("aria-valuenow",e),0==t?$("#nav-prev").addClass("disabled").removeAttr("href"):$("#nav-prev").removeClass("disabled").attr("href","#"+(t-1)),t>items.length?$("#nav-next").addClass("disabled").removeAttr("href"):$("#nav-next").removeClass("disabled").attr("href","#"+(t+1))}n.text=function(e){$("#title").html(e.text)},i.optional=function(e){var a=$("#item");e.answer.options.forEach(function(t,n){var i=n+1,o=$("#template div.radio").eq(0).clone();$("input",o).val(i).attr("name","options").attr("id",i),e.user_answered==i&&$("input",o).attr("checked","checked"),$("label",o).attr("for",i),$("label span",o).attr("data-number",i),$("label",o).append(t),o.appendTo(a)}),$("input",a).on("click.answer",function(){if(o)return!0;$("input",a).off("click.answer"),$("input",a).off("clicked.answer"),function(e){e=parseInt(e),items[t-1].user_answered=e,function(e,t){if("undefined"!=typeof Storage){var a=[];(sData=localStorage.getItem(sample_id))&&(a=sData.split(",")),a[e]=t,localStorage.setItem(sample_id,a.join(","))}r.push([e,t]),s||c()}(t-1,e);var a=$("input[value="+e+"]").parents("div.radio");$("#item div.radio").each(function(){this!=a[0]&&($("input",this).attr("disabled","disabled"),$(this).fadeTo("fast",.2))}),setTimeout(h,500)}($(this).val())}),$("input",a).on("clicked.answer",function(){$(this).trigger("click.answer")})},$(document).on("keyup",function(e){if(o)return!0;if(e.ctrlKey||e.shiftKey||e.altKey||-1!=["Control","Shift","Alt","Meta"].indexOf(e.key))return!0;if("Enter"==e.key||"ArrowLeft"==e.key?h():"ArrowRight"==e.key&&(t=parseInt(Math.min(Math.max(0,--t),items.length+1)),location.hash="#"+t),/^(Digit|Numpad)\d$/.test(e.code)){var a=e.code.replace(/Digit|Numpad/,"");$("input[value="+a+"]").trigger("clicked.answer")}}),$(window).on("hashchange",function(){if(o)return!0;/^#\d+$/.test(location.hash)&&(t=parseInt(location.hash.replace("#","")),function(){o=!0;var s=$("#item");if(0==t)return a="description",$("#title").html(e),$("#description").show(),s.hide(),u(),void(o=!1);if(t>items.length)return a="close",s.hide(),$("#description").hide(),$("#title").html("پایان نمونه‌گیری"),$("#close").show(),u(),void(o=!1);var r=items[t-1];"item"!=a&&($("#description").hide(),$("#close").hide(),a="item",s.show()),$("#title").fadeTo("fast",0),s.fadeTo("fast",0,function(){$(this).css("width",$(this).width()),$(this).children().remove(),n[r.type](r),i[r.answer.type](r),$(this).css("width","initial").fadeTo("fast",1),$("#title").fadeTo("fast",1),u(),o=!1})}())}),$(document).ready(function(){var e=$('<select class="form-control"></select>');e.on("change",function(){if(o)return!1;location.hash="#"+$(this).val(),$(this).attr("disabled","disabled")}),$('<option value="0">#</option>').appendTo(e),items.forEach(function(t,a){$('<option value="'+(a+1)+'">'+(a+1)+"</option>").appendTo(e)}),$('<option value="'+(items.length+1)+'">پایان</option>').appendTo(e),$("#nav-count").append(e),/^#\d+$/.test(location.hash)&&$(window).trigger("hashchange"),"undefined"!=typeof Storage&&(data=[],(sData=localStorage.getItem(sample_id))&&(data=sData.split(",")),data.forEach(function(e,t){!items[t].user_answered&&e&&(items[t].user_answered=e,r.push([t,e]))}),r.length&&c())}),$("#download").on("click",function(){for(var e=[sample_id],t=0;t<items.length;t++)e.push(items[t].user_answered);var a=e.join(","),n="plain/text",i=sample_id+".risloo",o=new Blob([a],{type:n}),s=document.createElement("a");return s.download=i,s.href=URL.createObjectURL(o),s.dataset.downloadurl=[n,s.download,s.href].join(":"),s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s),setTimeout(function(){URL.revokeObjectURL(s.href)},1500),!1})}();