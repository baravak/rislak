!function(){var t=$("[data-nav]"),a=0,e=[],n=!1,i=$('[data-nav][data-type="item"]');function s(){var t=a,i=e[Math.min(a+1,e.length-1)];t!=Math.min(a+1,e.length-1)?location.hash="#"+i:n=!1}function r(){var t=a,i=e[Math.max(0,a-1)];t!=Math.max(0,a-1)?location.hash="#"+i:n=!1}t.each(function(t){var a=$(this).attr("data-nav"),n=$(this).attr("data-title");e.push(a);var i=$("<option></option>").attr("value",a).html(n);0==t&&i.attr("selected","selected"),$("[data-nav-count]").append(i)}),$("[data-nav-next]").on("click",function(){if(n)return!1;n=!0,s()}),$("[data-nav-prev]").on("click",function(){if(n)return!1;n=!0,r()}),$("[data-nav-count]").on("change",function(){$(this).attr("disabled","disabled"),location.hash="#"+$(this).val()}),$(window).on("hashchange",function(){var s=location.hash.replace(/^#/,"")||e[0],r=function(t){return e.indexOf(t)}(s);$("[data-nav-count]").val(s),function(e){t.addClass("hidden").css("display","none"),t.eq(a).trigger("pannel:hide"),t.eq(e).css("display","none").removeClass("hidden").fadeIn("slow",function(){$("[data-nav-count]").removeAttr("disabled"),n=!1,t.eq(e).trigger("pannel:show")}),a=e,"item"==t.eq(e).attr("data-type")?$("[data-nav-text]").html(t.eq(e).attr("data-nav")+"/"+i.length):$("[data-nav-text]").html("0/"+i.length);var s=a/(t.length-1)*100;$("#progress").css("width",s+"%")}(r>-1?r:0)}),$(window).trigger("hashchange"),$(document).on("keyup",function(e){if(n)return!0;if(e.ctrlKey||e.shiftKey||e.altKey||-1!=["Control","Shift","Alt","Meta"].indexOf(e.key))return!0;var i=["TEXTAREA","INPUT"];if("Enter"==e.key||"ArrowLeft"==e.key?-1==i.indexOf(e.target.nodeName)&&s():"ArrowRight"==e.key&&-1==i.indexOf(e.target.nodeName)&&r(),/^(Digit|Numpad)\d$/.test(e.code)){var d=e.code.replace(/Digit|Numpad/,"");if(t.eq(a).is('[data-type="item"]')&&t.eq(a).has("[data-keyboard="+d+"]")){if(t.eq(a).is("[data-isnull]"))return;var l=$("[data-keyboard="+d+"]",t.eq(a));"radio"==l.attr("type")&&(l[0].checked=!0,l.trigger("change"))}}}),$("input, textarea, select",'[data-type="item"]').on("change",function(){if(!$(this).is("[data-mute]")){var t=$(this).attr("data-merge")?JSON.parse($(this).attr("data-merge")):[];if($(this).is(":radio, :hidden, textarea, input[type=number]")&&(t[1]=$(this).val(),$(this).parents('[data-type="item"]').attr("data-answer",$(this).val())),$(this).parents("[data-answer-description]").length&&(t={item:t[0],description:$(this).val()}),$(this).is("[data-nullable]")){if(!$(this).is(":checked"))return;t[1]=null}if("matrix_radio"==$(this).parents("[data-answer-type]").attr("data-answer-type")&&$(this).is("select")){var a=$(this).parents("[data-answer-type]"),e=a.attr("data-nav"),n=$("[data-matrixindex][data-matrix-row]",a).val(),i=$("[data-matrixindex][data-matrix-col]",a).val();null!==n&&null!==i&&((t=JSON.parse($(`#item-${e}-${n}-${i}`).attr("data-merge")))[1]=`${n},${i}`,$(`#item-${e}-${n}-${i}`)[0].checked=!0)}!function(t){if(d.push(t),l)return!1;h=-1,$("[data-sync-status]").html("درحال ذخیره‌کردن..."),c()}(t),u()}}),$("input",'[data-type="item"]').on("change",function(){if(-1==["optional","optional_images","range","matrix_radio"].indexOf($(this).parents("[data-nav]").attr("data-answer-type"))||!$(this).parents("[data-nav]").is("[data-autonext]"))return!0;if($(this).is(":radio")){$(this).next().css("opacity",""),$('[name="'+$(this).attr("name")+'"]').not('[value="'+$(this).val()+'"]').next().fadeTo("fast",.2);var t=this;setTimeout(function(){s(),$('[name="'+$(t).attr("name")+'"]').next().css("opacity","")},300)}});var d=[],l=!1,o=[1,3,5,10,15],h=0;function c(){l=!0;var t=d.splice(0);$.ajax({dataType:"json",url:"/$/"+sample_id+"/items",method:"post",scriptCharset:"utf-8",data:{items:t}}).always(function(a,e){if("success"!=e){for(var n=0;n<t.length;n++)d.push(t[n]);$("[data-sync-status]").html("در تلاش برای ذخیره‌کردن..."),h=Math.min(h+1,o.length-1),setTimeout(c,1e3*o[h])}else d.length?(h=-1,c(),$("[data-sync-status]").html("درحال ذخیره‌کردن...")):(l=!1,$("[data-sync-status]").html("بدون تغییر"))})}function u(){var t=[],a=null;i.each(function(e){["optional","optional_images"].indexOf($(this).attr("data-answer-type"))>=0&&($(this).attr("data-answer")?(null!==a&&t.push([a,e]),a=null):null===a&&(a=e+1))}),null!==a&&t.push([a,i.length]),t.forEach(function(a,e){a[0]==a[1]?t[e]=a[0]:a[1]-a[0]==1?t[e]=a[0]+" و "+a[1]:t[e]=a[0]+" تا "+a[1],t[e]=$('<a href="#'+a[0]+'"></a>').text(t[e])}),$("#nav-empty-answers").html(""),$("#nav-empty-answers").append(t)}$("[data-nav][data-nullable]").on("pannel:hide",function(){var t=$("input[data-nullable]",this);t.is(":checked")&&t.trigger("change")}),$('[data-nav="information"]').on("pannel:hide",function(){$("form",this).trigger("submit")}),u(),$("[data-nullable]").each(function(t,a){function e(){var t=$(this).parents("[data-nav]"),a=t.attr("data-nav"),e=$("input, textarea, select",`#answer-content-panel-${a}`);$(this).is(":checked")?(e.attr("disabled","disabled"),t.attr("data-isnull",1),$(`#answer-content-panel-${a}`).fadeTo("fast",.3)):(t.removeAttr("data-isnull",1),e.removeAttr("disabled"),$(`#answer-content-panel-${a}`).fadeTo("fast",1))}$(a).on("change",e),e.call(a)})}();