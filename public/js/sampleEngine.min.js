!function(){var t=$("#title").html(),e=0,a="description",n=new Object,i=new Object,s=!1,o=!1,r=[],d=[0,1,2],l=0;function c(){o=!0,$("#sync_status").text("درحال ذخیره سازی...");var t=r;r=[],$.ajax({dataType:"json",url:"/$/"+sample_id+"/items",method:"post",data:{items:t}}).always(function(e,a){if("success"!=a){$("#sync_alert").removeClass("d-none"),$("#sync_status").text("خطا! تلاش دوباره...");for(var n=0;n<t.length;n++)r.push(t[n]);i=d[Math.min(Math.max(0,++l),d.length-1)],setTimeout(c,1e3*i)}else $("#sync_alert").addClass("d-none"),l=0,$("#sync_status").text("ذخیره شده"),r.length?c():o=!1;var i})}function h(){e=parseInt(Math.min(Math.max(0,++e),items.length)),location.hash="#"+e}function u(){$("#nav-count").text(e);var t=100*e/items.length;$("#progress").css("width",t+"%").attr("aria-valuenow",t),0==e?$("#nav-prev").addClass("disabled").removeAttr("href"):$("#nav-prev").removeClass("disabled").attr("href","#"+(e-1)),e==items.length?$("#nav-next").addClass("disabled").removeAttr("href"):$("#nav-next").removeClass("disabled").attr("href","#"+(e+1))}n.text=function(t){$("#title").html(t.text)},i.optional=function(t){var a=$("#item");t.answer.options.forEach(function(e,n){var i=n+1,s=$("#template div.radio").eq(0).clone();$("input",s).val(i).attr("name","options").attr("id",i),t.user_answered==i&&$("input",s).attr("checked","checked"),$("label",s).attr("for",i),$("label span",s).attr("data-number",i),$("label",s).append(e),s.appendTo(a)}),$("input",a).on("click.answer",function(){if(s)return!0;$("input",a).off("click.answer"),$("input",a).off("clicked.answer"),function(t){t=parseInt(t),items[e-1].user_answered=t,function(t,e){if("undefined"!=typeof Storage){var a=[];(sData=localStorage.getItem(sample_id))&&(a=sData.split(",")),a[t]=e,localStorage.setItem(sample_id,a.join(","))}r.push([t,e]),o||c()}(e-1,t);var a=$("input[value="+t+"]").parents("div.radio");$("#item div.radio").each(function(){this!=a[0]&&($("input",this).attr("disabled","disabled"),$(this).fadeTo("fast",.2))}),setTimeout(h,500)}($(this).val())}),$("input",a).on("clicked.answer",function(){$(this).trigger("click.answer")})},$(document).on("keyup",function(t){if(s)return!0;if(t.ctrlKey||t.shiftKey||t.altKey||-1!=["Control","Shift","Alt","Meta"].indexOf(t.key))return!0;if("Enter"==t.key||"ArrowLeft"==t.key?h():"ArrowRight"==t.key&&(e=parseInt(Math.min(Math.max(0,--e),items.length)),location.hash="#"+e),/^(Digit|Numpad)\d$/.test(t.code)){var a=t.code.replace(/Digit|Numpad/,"");$("input[value="+a+"]").trigger("clicked.answer")}}),$(window).on("hashchange",function(){if(s)return!0;/^#\d+$/.test(location.hash)&&(e=parseInt(location.hash.replace("#","")),function(){s=!0;var o=$("#item");if(0==e)return a="description",$("#title").html(t),$("#description").show(),o.hide(),u(),void(s=!1);var r=items[e-1];"description"==a&&($("#description").hide(),a="item",o.show()),$("#title").fadeTo("fast",0),o.fadeTo("fast",0,function(){$(this).css("width",$(this).width()),$(this).children().remove(),n[r.type](r),i[r.answer.type](r),$(this).css("width","initial").fadeTo("fast",1),$("#title").fadeTo("fast",1),u(),s=!1})}())}),/^#\d+$/.test(location.hash)&&$(window).trigger("hashchange"),$(document).ready(function(){"undefined"!=typeof Storage&&(data=[],(sData=localStorage.getItem(sample_id))&&(data=sData.split(",")),data.forEach(function(t,e){!items[e].user_answered&&t&&(items[e].user_answered=t,r.push([e,t]))}),r.length&&c())}),$("#download").on("click",function(){for(var t=[sample_id],e=0;e<items.length;e++)t.push(items[e].user_answered);var a=t.join(","),n="plain/text",i=sample_id+".risloo",s=new Blob([a],{type:n}),o=document.createElement("a");return o.download=i,o.href=URL.createObjectURL(s),o.dataset.downloadurl=[n,o.download,o.href].join(":"),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout(function(){URL.revokeObjectURL(o.href)},1500),!1})}();