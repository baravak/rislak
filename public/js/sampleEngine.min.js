!function(){var t=$("[data-nav]"),a=0,n=[],e=0,i=!1;function s(){var t=n[Math.min(a+1,n.length-1)];location.hash="#"+t}function o(){var t=n[Math.max(0,a-1)];location.hash="#"+t}t.each(function(){var t=$(this).attr("data-nav"),a=$(this).attr("data-title");n.push(t);var i=$("<option></option>").attr("value",t).html(a);$("#nav-count").append(i),"item"==$(this).attr("data-type")&&++e}),$("#nav-next").on("click",function(){if(i)return!1;i=!0,s()}),$("#nav-prev").on("click",function(){if(i)return!1;i=!0,o()}),$("#nav-count").on("change",function(){$(this).attr("disabled","disabled"),location.hash="#"+$(this).val()}),$(window).on("hashchange",function(){var s=location.hash.replace(/^#/,""),o=function(t){return n.indexOf(t)}(s);$("#nav-count").val(s),function(n){t.addClass("hidden").css("display","none"),t.eq(n).css("display","none").removeClass("hidden").fadeIn("slow",function(){$("#nav-count").removeAttr("disabled"),i=!1}),a=n,"item"==t.eq(n).attr("data-type")?$("#nav-text").html(t.eq(n).attr("data-nav")+"/"+e):$("#nav-text").html("0/"+e);var s=a/(t.length-1)*100;$("#progress").css("width",s+"%")}(o>-1?o:0)}),$(window).trigger("hashchange"),$(document).on("keyup",function(n){if(i)return!0;if(n.ctrlKey||n.shiftKey||n.altKey||-1!=["Control","Shift","Alt","Meta"].indexOf(n.key))return!0;if("Enter"==n.key||"ArrowLeft"==n.key?s():"ArrowRight"==n.key&&o(),/^(Digit|Numpad)\d$/.test(n.code)){var e=n.code.replace(/Digit|Numpad/,"");if(t.eq(a).is('[data-type="item"]')&&t.eq(a).has("[data-keyboard="+e+"]")){var r=$("[data-keyboard="+e+"]",t.eq(a));"radio"==r.attr("type")&&(r[0].checked=!0,r.trigger("change"))}}}),$("input",'[data-type="item"]').on("change",function(){var t=JSON.parse($(this).attr("data-merge"));$(this).is(":radio")&&(t[1]=$(this).val()),function(t){if(r.push(t),c)return!1;d=-1,$("#sync_status").html("درحال ذخیره‌کردن..."),u()}(t)}),$("input",'[data-type="item"][data-autonext]').on("change",function(){if($(this).is(":radio")){$(this).next().css("opacity",""),$('[name="'+$(this).attr("name")+'"]').not('[value="'+$(this).val()+'"]').next().fadeTo("fast",.2);var t=this;setTimeout(function(){s(),$('[name="'+$(t).attr("name")+'"]').next().css("opacity","")},300)}});var r=[],c=!1,h=[1,3,5,10,15],d=0;function u(){c=!0;var t=r.splice(0);$.ajax({dataType:"json",url:"/$/"+sample_id+"/items",method:"post",data:{items:t}}).always(function(a,n){if("success"!=n){for(var e=0;e<t.length;e++)r.push(t[e]);$("#sync_status").html("در تلاش برای ذخیره‌کردن..."),d=Math.min(d+1,h.length-1),setTimeout(u,1e3*h[d])}else r.length?(d=-1,u(),$("#sync_status").html("درحال ذخیره‌کردن...")):(c=!1,$("#sync_status").html("بدون تغییر"))})}}();