am4chart_fa={Export:"خروجی",Image:"تصویر",Data:"داده",Print:"پرینت   "};var score_chart={};function select2result_room(e,a){if(!e.all&&e.element&&(e.all=JSON.parse($(e.element).attr("data-json")),$(e.element).attr("data-json","")),e.all){var t=$('<div class="d-flex align-items-center fs-12 d-inline-block"><span class="media media-sm media-primary"><img alt="A"></span><div class="pr-1"><div class="font-weight-bold data-name"></div><div class="fs-10 data-id"></div></div></div>'),r=select2find_data(e.all,$(this).attr("data-avatar")||"avatar.tiny.url avatar.small.url");r?$("img",t).attr("src",r):($("img",t).remove(),$(".media",t).html("<span>"+(e.text?e.text.substr(0,1):"IR")+"</span>"));var i=e.text||e.id;$("div.data-name",t).html(i);var l=e.all.center.detail.title;return $("div.data-id",t).html(l),t}return e.text}function select2result_center(e,a){if(!e.all&&e.element&&(e.all=JSON.parse($(e.element).attr("data-json")),$(e.element).attr("data-json","")),e.all){var t=$('<div class="d-flex align-items-center fs-12 d-inline-block"><span class="media media-sm media-primary"><img alt="A"></span><div class="pr-1"><div class="font-weight-bold data-name"></div><div class="fs-10 data-id"></div></div></div>'),r=select2find_data(e.all,$(this).attr("data-avatar")||"detail.avatar.tiny.url detail.avatar.small.url");r?$("img",t).attr("src",r):($("img",t).remove(),$(".media",t).html("<span>"+(e.text?e.text.substr(0,1):"RS")+"</span>"));var i=select2find_data(e.all,$(this).attr("data-title")||"detail.title");$("div.data-name",t).html(i);e.text;return $("div.data-id",t).html(e.id),t}return e.text}function select2result_case_clients(e,a){if(!e.all&&e.element&&(e.all=JSON.parse($(e.element).attr("data-json")),$(e.element).attr("data-json","")),!e.all)return e.text;var t=[];e.all.clients.forEach(function(e){t.push(e.user.name||e.user.id)});var r=$("<span></span>");return $("<div>"+t.join("- ")+"</div>").addClass("fs-12").appendTo(r),$("<div></div>").text(e.id).addClass("fs-10").appendTo(r),r}function select2result_sessions(e,a){if(!e.all&&e.element&&(e.all=JSON.parse($(e.element).attr("data-json")),$(e.element).attr("data-json","")),!e.all)return e.text;var t=$("<div></div>").addClass("row m-0 p-0"),r=new Date(e.all.started_at),i=new persianDate(r).calendar(),l=i.year+"/"+i.month+"/"+i.day,n=r.getHours();return n+=":"+r.getMinutes(),$("<div>"+e.all.status+"</div>").addClass("col-4 fs-12").appendTo(t),$("<div>"+l+"</div>").addClass("col-3 fs-10").appendTo(t),$("<div>"+n+"</div>").addClass("col-3 fs-10").appendTo(t),t}function scoringResult(e,a){var t=this;e.data.score&&($(this).is(".lijax-preload")&&($("#"+$(this).attr("data-lijax-preload")).eq(0).fadeOut("fast",function(){$("#profile-export-menu").hide().removeClass("d-none").fadeIn("fast")}),$(this).removeClass("lijax-preload")));if(e.data.score&&e.data.profiles){for(var r in e.data.profiles){var i=e.data.profiles[r];$(".profile-link.profile-"+r).eq(0).length?$(".profile-link.profile-"+r).attr("href",i.url):$('<a href="'+i.url+'" target="_blank" data-type="'+r+'" class="dropdown-item fs-12 profile-link profile-'+r+'">'+r.replace("profile_","").replace(/_/gi," ").toUpperCase()+"</a>").appendTo("#profile-export-list")}$(".profile-link").fadeIn("fast"),200!=a.status?setTimeout(function(){scoringResultAwaiting.call(t,e)},5e3):($("#scoring-extends").length&&new Statio({type:"render",context:$("#scoring-extends").eq(0),ajax:{cache:!1,method:"get"},url:"/dashboard/samples/"+e.data.id+"/scoring?html=1"}),$("#profile-export i").fadeOut("fast",function(){$(this).addClass("d-none")})),e.data.profiles.profile_svg&&!$("#profile_svg img").length&&($("#profile_svg *").remove(),$("#profile_svg").append($('<img src="'+e.data.profiles.profile_svg.url+'" class="d-none">')),$("#profile_svg img").hide().removeClass("d-none").fadeIn("slow").addClass("d-block"))}else setTimeout(function(){scoringResultAwaiting.call(t,e)},2e3)}function scoringResultAwaiting(e){$.ajax({context:this,url:"/dashboard/samples/"+e.data.id+"/scoring",success:function(e,a,t){scoringResult.call(this,e,t)}})}score_chart["16PF-93"]=function(e){var a=am4core.create($(this).attr("id"),am4charts.XYChart);a.language.locale=am4chart_fa,a.rtl=!0;var t={A:{min:"مردم‌گریزی",max:"مردم‌آمیزی"},B:{min:"استدلال عینی",max:"استدلال انتزاعی"},C:{min:"ناپایداری هیجانی",max:"پایداری هیجانی"},E:{min:"سلطه‌پذیری",max:"سلطه‌گری"},F:{min:"دل‌مردگی",max:"سرزندگی"},G:{min:"مصلحت‌گرا",max:"باوجدان"},H:{min:"ترسو",max:"جسور"},I:{min:"یک‌دنده",max:"حساس"},L:{min:"زودباور",max:"شکاک"},M:{min:"عمل‌گرا",max:"کولی‌باز"},N:{min:"بی‌ظرافت",max:"ظرافت"},O:{min:"مستعد احساس گناه",max:"اطمینان به خود"},Q1:{min:"بازبودن نسبت به تغییر",max:"بنیاد‌گرایی"},Q2:{min:"متکی به دیگران",max:"مسلط بر خود"},Q3:{min:"اختلال‌مدار",max:"کمال‌گرا"},Q4:{min:"آرام",max:"اضطراب"}};for(var r in t)a.data.push({factor:r,score:++e[r.toLowerCase()],min:t[r].min,max:t[r].max});a.paddingTop=100;var i=a.chartContainer.createChild(am4core.Label);i.text="عوامل مرتبه اول",i.align="center";var l=a.xAxes.push(new am4charts.CategoryAxis);l.dataFields.category="factor",l.renderer.minGridDistance=1;var n=a.xAxes.push(new am4charts.CategoryAxis);n.dataFields.category="min",n.renderer.labels.template.rotation=90,n.renderer.labels.template.paddingTop=-10,n.renderer.minGridDistance=1,n.renderer.labels.template.fontSize=12,n.renderer.labels.template.fontSize=12,n.renderer.labels.template.valign="top",n.renderer.grid.template.strokeOpacity=.1,n.renderer.grid.template.strokeWidth=0,n.renderer.grid.template.stroke="white",n.renderer.labels.template.adapter.add("fill",function(e,a){if(a.dataItem._dataContext){if(a.dataItem._dataContext.score<=3)return"black";if(4==a.dataItem._dataContext.score)return"#888888"}return"#dedede"}),n.renderer.labels.template.adapter.add("fontWeight",function(e,a){if(a.dataItem._dataContext){if(a.dataItem._dataContext.score<=3)return"900";if(4==a.dataItem._dataContext.score)return"700"}return"normal"});var s=a.xAxes.push(new am4charts.CategoryAxis);s.dataFields.category="max",s.renderer.inside=!0,s.renderer.labels.template.paddingTop=-10,s.renderer.labels.template.paddingLeft=-100,s.renderer.labels.template.rotation=90,s.renderer.labels.template.fontSize=12,s.renderer.minGridDistance=1,s.renderer.labels.template.align="left",s.renderer.labels.template.valign="top",s.renderer.labels.template.adapter.add("fill",function(e,a){if(a.dataItem._dataContext){if(a.dataItem._dataContext.score>=8)return"black";if(7==a.dataItem._dataContext.score)return"#888888"}return"#dedede"}),s.renderer.labels.template.adapter.add("fontWeight",function(e,a){if(a.dataItem._dataContext){if(a.dataItem._dataContext.score>=8)return"900";if(7==a.dataItem._dataContext.score)return"700"}return"normal"});var o=a.yAxes.push(new am4charts.ValueAxis);o.renderer.minGridDistance=10,o.min=0,o.max=10,o.renderer.grid.template.strokeWidth=1;var d=a.series.push(new am4charts.ColumnSeries);d.dataFields.categoryX="factor",d.dataFields.categoryX1="min",d.dataFields.categoryZ="min",d.dataFields.valueY="score",d.columns.template.width=0,d.columns.template.align="left";var c=d.bullets.create(am4charts.CircleBullet);c.fill="#1A5276",c.scale=2.5,c.strokeWidth=0,c.stroke="#1A5276",c.dy=14;var m=d.bullets.push(new am4charts.LabelBullet);function p(e,a,t,r){var i=e.axisRanges.create();i.value=a,i.endValue=t,i.axisFill.fill=r,i.axisFill.fillOpacity=1,i.grid.strokeOpacity=0}m.label.text="{score}",m.label.fontSize=12,m.label.fill="#ffffff",m.label.dy=13,m.label.dx=0,m.label.hideOversized=!1,m.label.truncate=!1,window.test={min:n,max:s,valueAxis:o},p(o,0,1,am4core.color("#5DADE2")),p(o,1,2,am4core.color("#5DADE2")),p(o,2,3,am4core.color("#5DADE2")),p(o,7,8,am4core.color("#5DADE2")),p(o,8,9,am4core.color("#5DADE2")),p(o,9,10,am4core.color("#5DADE2")),p(o,3,4,am4core.color("#D6EAF8")),p(o,6,7,am4core.color("#D6EAF8")),p(o,4,5,am4core.color("#EBF5FB")),p(o,5,6,am4core.color("#EBF5FB")),a.exporting.menu=new am4core.ExportMenu,a.exporting.menu.items=[{label:"خروجی",menu:[{type:"pdf",label:"PDF"},{type:"xlsx",label:"اکسل"}]}];var u=a.createChild(am4core.Label);u.text="risloo.com",u.fontSize=12,u.align="left",u.fillOpacity=.5,a.exporting.adapter.add("pdfmakeDocument",function(e,a){return e.doc.content.unshift({text:"ریسلو",margin:[0,30],style:{fontSize:25,bold:!0}}),e}),a.exporting.getFormatOptions("pdf").addURL=!1},$("body").on("statio:dashboard:sessions:report:create",function(){$("#encryption_type",this).on("change",function(){if("publicKey"!=$(this).val())return $("#encrypt_alert").addClass("d-none"),$("button[type=submit]",$(this).parents("form")).removeAttr("disabled"),void $("#report").removeAttr("readonly");$("button[type=submit]",$(this).parents("form")).attr("disabled","disabled"),$("#encrypt_alert").removeClass("d-none")}).trigger("change"),$("#encrypt_alert button").on("click",function(){if(!$("#report").val())return!0;var e=$("#report").val();$("#report").val(encryptPublicLong(e,auth_public_key)),$("button[type=submit]",$(this).parents("form")).removeAttr("disabled"),$("#encrypt_alert").addClass("d-none"),$("#report").attr("readonly","readonly")})}),$("body").on("statio:dashboard:sessions:create",function(){}),$("body").on("statio:dashboard:samples:show",function(){$("#scoring-btn",this).on("statio:jsonResponse",function(e,a,t){$(".profile-link").remove(),$("#scoring-extends").html(""),a.is_ok?($("#profile-export i").removeClass("d-none"),$("#profile_svg *").remove(),$("#profile_svg").append($('<i class="fas fa-cog fa-spin"></i>')),scoringResult.call(this,a,t)):$(".status-action").show()}).on("statio:init",function(){$(".status-action").hide(),$("#profile-export-menu").addClass("d-none")}),["scoring","craeting_files"].indexOf($("#sample-show").attr("data-status"))>=0&&("scoring"==$("#sample-show").attr("data-status")&&$("#scoring-btn").addClass("lijax-preload"),scoringResultAwaiting.call($("#scoring-btn")[0],{data:{id:$("#sample-show").attr("data-sample")}}))}),$("body").on("statio:dashboard:centers:create statio:dashboard:centers:edit",function(){$("[name=type]",this).on("change",function(e,a){var t=$("#manager_id"),r=t.attr("data-url"),i=r;(r=url.parse(r)).get=r.get?r.get:{},$("#type-personal_clinic[name=type]").is(":checked")?(r.get.personal_clinic="no",$("#avatar, #title").prop("disabled",!0),$("#avatar, #title").parents(".form-group").fadeOut("fast")):(a||$("#title").val(""),$("#avatar, #title").prop("disabled",!1),$("#avatar, #title").parents(".form-group").fadeIn("fast"),r.get.personal_clinic="yes"),url.build(r)!=i&&(t.attr("data-url",url.build(r)),$("*",t).remove(),t.select2("destroy"),select2element.call(t[0]))}),$("[name=type]").eq(0).trigger("change",[!0])}),$("body").on("statio:dashboard:samples:show",function(){$("#editable",this).on("change",function(){$(this).is(":checked")?$(".form-items").removeAttr("disabled"):$(".form-items").attr("disabled","disabled")})}),$("body").on("statio:dashboard:reserves:create",function(){$("#started_at").on("change",function(e,a,t){var r=$("#calendar").attr("data-from"),i=$("#calendar").attr("data-to"),l=$(this).val();r<=l&&i>=l||new Statio({type:"render",context:this,ajax:{cache:!1,method:"get",data:{room_id:$("#room_id").val(),time:l}},url:$("#calendar").attr("data-url")})})}),$("body").on("statio:dashboard:samples:create",function(){$("#room-tab").on("show.bs.tab",function(){$("input, select, checkbox, radio","#room").each(function(){$(this).is(".disabled:disabled")&&$(this).removeAttr("disabled").removeClass("disabled")}),$("input, select, checkbox, radio","#case").each(function(){$(this).is(":disabled")||$(this).attr("disabled","disabled").addClass("disabled")})}).on("hide.bs.tab",function(){$("input, select, checkbox, radio","#room").each(function(){$(this).is(":disabled")||$(this).attr("disabled","disabled").addClass("disabled")}),$("input, select, checkbox, radio","#case").each(function(){$(this).is(".disabled:disabled")&&$(this).removeAttr("disabled").removeClass("disabled")})}),$("#room-tab").trigger(($("#room-tab").is(".active")?"show":"hide")+".bs.tab"),$("#room_client_id.sample-page").on("change",function(){$(this).val()&&$(this).val().length?$("#count").attr("disabled","disabled"):$("#count").removeAttr("disabled")}),$("#count.sample-page").on("change",function(){$(this).val()?$("#room_client_id.sample-page").attr("disabled","disabled"):$("#room_client_id.sample-page").removeAttr("disabled")}),$("#case_id").on("select2:select",function(e){$("#client-null-tamplate").hide(),e.params.data.all.clients.forEach(function(e,a){var t=$("#client-template").clone();t.removeClass("d-none"),t.removeAttr("id"),$(".data-name",t).text(e.user.name),(e.user.avatar?e.user.avatar.small:null)?$("img",t).attr("src",e.user.avatar.small.url):($("img",t).remove(),$(".media",t).append("<span>"+e.user.name.substr(0,1)+"</span>")),$("input",t).attr("id","client-"+e.user.id).attr("name","client_id[]").attr("value",e.id),$("label",t).attr("for","client-"+e.user.id),t.appendTo("#client-list")})}),$("#case_id").on("change",function(){$("#client-list .richak").remove(),$(this).val()||$("#client-null-tamplate").show()})}),$(document).on("statio:global:renderResponse",function(e,a,t){var r=location.hash;$('[data-toggle=tab][href$="'+r+'"]').trigger("click"),$("[data-encType=publicKey]").each(function(){if(localStorage.privateKey){var e=this;asyncDecryptPrivateLong($(this)[$(this).is("input, textarea")?"val":"html"](),localStorage.privateKey).then(function(a){$(e).is("input, textarea")?$(e).val(a):$(e).html(a.replace(/\n/gim,"<br>"))})}}),a.each(function(){$("#privateKey",a).on("change",function(){localStorage.privateKey=$(this).val()}).val(localStorage.privateKey),$("[data-toggle=tab]",a).on("click",function(){var e=$(this).attr("href").match(/(\#.+)$/);e&&(location.hash=e[1])}),$(".score_data",this).each(function(){var e=JSON.parse($(this).text()),a=$(this).attr("data-scale-id");score_chart[a].call(this,e)})})});